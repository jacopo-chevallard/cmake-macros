# An external project for BC03_UTILITIES
set ( BC03_UTILITIES_PREFIX "${CMAKE_BINARY_DIR}/dependencies" )

set ( BC03_UTILITIES_SOURCE  "${BC03_UTILITIES_PREFIX}/bc03_utilities-src" )
set ( BC03_UTILITIES_BINARY  "${BC03_UTILITIES_PREFIX}/bc03_utilities" )
set ( BC03_UTILITIES_INSTALL ${CMAKE_INSTALL_PREFIX} )

set (BC03_UTILITIES_LIBRARY_NAME bc03_utilities)
set (BC03_UTILITIES_CMAKE_LIBDIR ${CMAKE_INSTALL_PREFIX}/lib)
set (BC03_UTILITIES_CMAKE_INCLUDEDIR ${CMAKE_INSTALL_PREFIX}/include/${BC03_UTILITIES_LIBRARY_NAME})

# You need to pass fixed format flags
if ( CMAKE_Fortran_COMPILER_ID STREQUAL GNU )
  set ( CMAKE_Local_Fortran_FLAGS "${CMAKE_Fortran_FLAGS} -ffixed-line-length-none" )
elseif( CMAKE_Fortran_COMPILER_ID STREQUAL Intel )
  set ( CMAKE_Local_Fortran_FLAGS "${CMAKE_Fortran_FLAGS} -fixed -extend-source" )
endif ( CMAKE_Fortran_COMPILER_ID STREQUAL GNU )

ExternalProject_Add(
  EXT_BC03_UTILITIES
  DOWNLOAD_DIR ${BC03_UTILITIES_PREFIX}
  SOURCE_DIR ${BC03_UTILITIES_SOURCE}
  BINARY_DIR ${BC03_UTILITIES_BINARY}
  INSTALL_DIR ${BC03_UTILITIES_INSTALL}
  URL ${CMAKE_CURRENT_SOURCE_DIR}/dependencies/archives/bc03_utilities.tar.gz
  PATCH_COMMAND cp $ENV{CMAKE_MACROS}/external/bc03_utilities/CMakeLists.txt <SOURCE_DIR>
  CMAKE_ARGS -DCMAKE_Fortran_COMPILER=${CMAKE_Fortran_COMPILER} -DCMAKE_Fortran_FLAGS=${CMAKE_Local_Fortran_FLAGS} -DCMAKE_INSTALL_PREFIX=<INSTALL_DIR> -DCMAKE_NO_DEFAULT_PATH=${CMAKE_NO_DEFAULT_PATH} -DCMAKE_PARENT_SOURCE_DIR=${CMAKE_CURRENT_SOURCE_DIR}
  #TEST_BEFORE_INSTALL 1
  #TEST_COMMAND make test
  )

set ( BC03_UTILITIES_INCLUDE_DIR ${BC03_UTILITIES_CMAKE_INCLUDEDIR} CACHE INTERNAL "BC03_UTILITIES include directory" )
set ( BC03_UTILITIES_LIBRARIES "${BC03_UTILITIES_CMAKE_LIBDIR}/${CMAKE_LIBRARY_PREFIX}${BC03_UTILITIES_LIBRARY_NAME}${CMAKE_LIBRARY_SUFFIX}" CACHE INTERNAL "BC03_UTILITIES library" )
