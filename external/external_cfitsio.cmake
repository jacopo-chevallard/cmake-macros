# An external project for CFITSIO
# URL ftp://heasarc.gsfc.nasa.gov/software/fitsio/c/cfitsio3370.tar.gz
set ( CFITSIO_PREFIX "${CMAKE_BINARY_DIR}/dependencies" )

set ( CFITSIO_SOURCE  "${CFITSIO_PREFIX}/cfitsio-src" )
set ( CFITSIO_BINARY  "${CFITSIO_PREFIX}/cfitsio" )
set ( CFITSIO_INSTALL ${CMAKE_INSTALL_PREFIX} )

set (CFITSIO_LIBRARY_NAME cfitsio)
set (CFITSIO_CMAKE_LIBDIR "${CMAKE_INSTALL_PREFIX}/lib")
set (CFITSIO_CMAKE_INCLUDEDIR "${CMAKE_INSTALL_PREFIX}/include/${CFITSIO_LIBRARY_NAME}")

# Check if your machine support SSE3
find_package( SSE )

if ( SSSE3_FOUND  )
  set ( CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -mssse3")
endif ( SSSE3_FOUND  )

ExternalProject_Add(
  EXT_cfitsio
  DOWNLOAD_DIR ${CFITSIO_PREFIX}
  SOURCE_DIR ${CFITSIO_SOURCE}
  BINARY_DIR ${CFITSIO_BINARY}
  INSTALL_DIR ${CFITSIO_INSTALL}
  URL $ENV{CMAKE_DEPENDENCIES}/archives/cfitsio3390.tar.gz
  PATCH_COMMAND cp $ENV{CMAKE_MACROS}/external/cfitsio/CMakeLists.txt <SOURCE_DIR>
  CMAKE_ARGS -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER} -DCMAKE_C_FLAGS=${CMAKE_C_FLAGS} -DCMAKE_INSTALL_PREFIX=<INSTALL_DIR> -DCMAKE_SKIP_BUILD_RPATH:BOOL=OFF -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=OFF -DCMAKE_INSTALL_RPATH=<INSTALL_DIR>/lib -DCMAKE_INSTALL_NAME_DIR=<INSTALL_DIR>/lib -DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=ON -DCMAKE_NO_DEFAULT_PATH=${CMAKE_NO_DEFAULT_PATH} -DCMAKE_LIBRARY_TYPE=${CMAKE_LIBRARY_TYPE}

  )

set ( CFITSIO_INCLUDE_DIR ${CFITSIO_CMAKE_INCLUDEDIR} CACHE INTERNAL "CFITSIO include directory" )
set ( CFITSIO_LIBRARIES "${CFITSIO_CMAKE_LIBDIR}/${CMAKE_LIBRARY_PREFIX}${CFITSIO_LIBRARY_NAME}${CMAKE_LIBRARY_SUFFIX}" CACHE INTERNAL "CFITSIO library" )

# Set package version number
set ( CFITSIO_VERSION_MAJOR 3 CACHE INTERNAL "CFITSIO major version number")
set ( CFITSIO_VERSION_MINOR 39 CACHE INTERNAL "CFITSIO minor version number")
