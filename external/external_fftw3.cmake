# An external project for FFTW
# URL http://www.fftw.org/fftw-3.3.5.tar.gz
set ( FFTW3_PREFIX "${CMAKE_BINARY_DIR}/dependencies" )

set ( FFTW3_SOURCE  "${FFTW3_PREFIX}/fftw3-src" )
set ( FFTW3_BINARY  "${FFTW3_PREFIX}/fftw3" )
set ( FFTW3_INSTALL ${CMAKE_INSTALL_PREFIX} )

set (FFTW3_LIBRARY_NAME fftw3)
set (FFTW3_CMAKE_LIBDIR ${CMAKE_INSTALL_PREFIX}/lib)
set (FFTW3_CMAKE_INCLUDEDIR ${CMAKE_INSTALL_PREFIX}/include/${FFTW3_LIBRARY_NAME})

ExternalProject_Add(
  EXT_fftw3
  DOWNLOAD_DIR ${FFTW3_PREFIX}
  SOURCE_DIR ${FFTW3_SOURCE}
  BINARY_DIR ${FFTW3_BINARY}
  INSTALL_DIR ${FFTW3_INSTALL}
  #TEST_BEFORE_INSTALL 1
  #TEST_COMMAND make check
  URL $ENV{CMAKE_DEPENDENCIES}/archives/fftw-3.3.5.tar.gz
  CONFIGURE_COMMAND <SOURCE_DIR>/configure --prefix=<INSTALL_DIR> --includedir=${FFTW3_CMAKE_INCLUDEDIR} --enable-shared CC=${CMAKE_C_COMPILER} CFLAGS=${CMAKE_C_FLAGS} CXX=${CMAKE_CXX_COMPILER} CXXFLAGS=${CMAKE_CXX_FLAGS}
  )

set ( FFTW3_INCLUDE_DIR ${FFTW3_CMAKE_INCLUDEDIR} CACHE INTERNAL "FFTW3 include directory" )
set ( FFTW3_LIBRARIES "${FFTW3_CMAKE_LIBDIR}/${CMAKE_LIBRARY_PREFIX}${FFTW3_LIBRARY_NAME}${CMAKE_LIBRARY_SUFFIX}" CACHE INTERNAL "FFTW3 library" )

# Set package version number
set ( FFTW3_VERSION_MAJOR 3 CACHE INTERNAL "FFTW3 major version number" )
set ( FFTW3_VERSION_MINOR 3 CACHE INTERNAL "FFTW3 minor version number" )
set ( FFTW3_VERSION_PATCH 5 CACHE INTERNAL "FFTW3 patch version number" )
