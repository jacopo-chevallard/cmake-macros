# An external project for FRUIT
# URL https://sourceforge.net/projects/fortranxunit/
# see also http://www.software.ac.uk/blog/2014-07-22-look-fortran-unit-test-frameworks
set ( FRUIT_PREFIX ${CMAKE_BINARY_DIR}/dependencies )

set ( FRUIT_SOURCE  ${FRUIT_PREFIX}/fruit-src )
set ( FRUIT_BINARY  ${FRUIT_PREFIX}/fruit )
set ( FRUIT_INSTALL ${CMAKE_INSTALL_PREFIX} )

set(FRUIT_LIBRARY_NAME fruit)
set (FRUIT_CMAKE_LIBDIR ${CMAKE_INSTALL_PREFIX}/lib)
set (FRUIT_CMAKE_INCLUDEDIR ${CMAKE_INSTALL_PREFIX}/include/${FRUIT_LIBRARY_NAME})

set (GIT_FRUIT "https://github.com/jacopo-chevallard/FRUIT.git")

if (fruit_version)

  ExternalProject_Add(
    EXT_${FRUIT_LIBRARY_NAME}
    DOWNLOAD_DIR ${FRUIT_PREFIX}
    SOURCE_DIR ${FRUIT_SOURCE}
    BINARY_DIR ${FRUIT_BINARY}
    INSTALL_DIR ${FRUIT_INSTALL}
    GIT_REPOSITORY ${GIT_FRUIT}
    GIT_TAG ${fruit_version}
    CMAKE_ARGS -DCMAKE_Fortran_COMPILER=${CMAKE_Fortran_COMPILER} -DCMAKE_Fortran_FLAGS=${CMAKE_Fortran_FLAGS} -DCMAKE_INSTALL_PREFIX=<INSTALL_DIR> -DCMAKE_NO_DEFAULT_PATH=${CMAKE_NO_DEFAULT_PATH} -DSHIPPABLE=${SHIPPABLE} -DCMAKE_PARENT_SOURCE_DIR=${CMAKE_CURRENT_SOURCE_DIR} -DCMAKE_LIBRARY_TYPE=${CMAKE_LIBRARY_TYPE}
    )

else (fruit_version)

  ExternalProject_Add(
    EXT_${FRUIT_LIBRARY_NAME}
    DOWNLOAD_DIR ${FRUIT_PREFIX}
    SOURCE_DIR ${FRUIT_SOURCE}
    BINARY_DIR ${FRUIT_BINARY}
    INSTALL_DIR ${FRUIT_INSTALL}
    GIT_REPOSITORY ${GIT_FRUIT}
    CMAKE_ARGS -DCMAKE_Fortran_COMPILER=${CMAKE_Fortran_COMPILER} -DCMAKE_Fortran_FLAGS=${CMAKE_Fortran_FLAGS} -DCMAKE_INSTALL_PREFIX=<INSTALL_DIR> -DCMAKE_NO_DEFAULT_PATH=${CMAKE_NO_DEFAULT_PATH} -DSHIPPABLE=${SHIPPABLE} -DCMAKE_PARENT_SOURCE_DIR=${CMAKE_CURRENT_SOURCE_DIR} -DCMAKE_LIBRARY_TYPE=${CMAKE_LIBRARY_TYPE}
    )

endif (fruit_version)

set ( FRUIT_INCLUDE_DIR ${FRUIT_CMAKE_INCLUDEDIR} CACHE INTERNAL "FRUIT include directory" )
set ( FRUIT_LIBRARIES "${FRUIT_CMAKE_LIBDIR}/${CMAKE_LIBRARY_PREFIX}${FRUIT_LIBRARY_NAME}${CMAKE_LIBRARY_SUFFIX}" CACHE INTERNAL "FRUIT library" )
