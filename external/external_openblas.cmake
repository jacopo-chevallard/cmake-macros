# An external project for BLAS/OPENBLAS
# http://www.openblas.net
set ( OPENBLAS_PREFIX "${CMAKE_BINARY_DIR}/dependencies" )

set ( OPENBLAS_SOURCE  "${OPENBLAS_PREFIX}/openblas-src" )
set ( OPENBLAS_BINARY  "${OPENBLAS_PREFIX}/openblas" )
set ( OPENBLAS_INSTALL ${CMAKE_INSTALL_PREFIX} )

set (OPENBLAS_LIBRARY_NAME openblas)
set (OPENBLAS_CMAKE_LIBDIR ${CMAKE_INSTALL_PREFIX}/lib)
set (OPENBLAS_CMAKE_INCLUDEDIR ${CMAKE_INSTALL_PREFIX}/include)

ExternalProject_Add(
  EXT_openblas
  DOWNLOAD_DIR ${OPENBLAS_PREFIX}
  SOURCE_DIR ${OPENBLAS_SOURCE}
  INSTALL_DIR ${OPENBLAS_INSTALL}
  #GIT_REPOSITORY https://github.com/xianyi/OPENBLAS.git
  #GIT_TAG v0.2.14
  URL $ENV{CMAKE_DEPENDENCIES}/archives/OpenBLAS-0.2.18.tar.gz
  BUILD_IN_SOURCE 1
  CONFIGURE_COMMAND ""
  BUILD_COMMAND make CC=${CMAKE_C_COMPILER} FC=${CMAKE_Fortran_COMPILER} HOSTCC=${CMAKE_C_COMPILER}
  INSTALL_COMMAND make install PREFIX=<INSTALL_DIR>
  )

set ( OPENBLAS_INCLUDE_DIR ${OPENBLAS_CMAKE_INCLUDEDIR} CACHE INTERNAL "OPENBLAS include directory" )
set ( OPENBLAS_LIBRARIES "${OPENBLAS_CMAKE_LIBDIR}/${CMAKE_LIBRARY_PREFIX}${OPENBLAS_LIBRARY_NAME}${CMAKE_LIBRARY_SUFFIX}" CACHE INTERNAL "OPENBLAS library" )

# Set package version number
set ( OPENBLAS_VERSION_MAJOR 0 CACHE INTERNAL "OPENBLAS major version number" )
set ( OPENBLAS_VERSION_MINOR 2 CACHE INTERNAL "OPENBLAS minor version number" )
set ( OPENBLAS_VERSION_PATCH 18 CACHE INTERNAL "OPENBLAS patch version number" )
